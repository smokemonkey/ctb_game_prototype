<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>时间系统演示</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <script src="/config.js"></script>
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        .container {
            padding: 40px;
            background-color: #1e1e1e;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }
        #time-display {
            margin-bottom: 30px;
        }
        #date-display {
            font-size: 2.5em;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        #era-display {
            font-size: 1.5em;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s ease;
            background-color: #4CAF50;
            color: white;
        }
        .btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .btn.danger { background-color: #f44336; }
        .btn.danger:hover { background-color: #e53935; }
        .btn.info { background-color: #2196F3; }
        .btn.info:hover { background-color: #1e88e5; }
    </style>
</head>
<body>
    <div class="container">
        <div id="time-display">
            <h2 id="era-display">--</h2>
            <h1 id="date-display">Loading...</h1>
        </div>
        <div class="controls">
            <div class="control-group">
                <button class="btn" id="start-stop-btn">开始</button>
                <button class="btn danger" id="reset-btn">重置</button>
            </div>
            <div class="control-group">
                <button class="btn info" onclick="quickAdvance(1, 'day')">+1 天</button>
                <button class="btn info" onclick="quickAdvance(30, 'day')">+1 月</button>
                <button class="btn info" onclick="quickAdvance(360, 'day')">+1 年</button>
            </div>
        </div>
    </div>
    <script>
        // 模拟 Python 的 TimeManager 类
        class TimeManager {
            constructor(startYear) {
                this.BASE_YEAR = startYear;
                this.HOURS_PER_DAY = 24;
                this.DAYS_PER_YEAR = 360;
                this._total_hours = 0;
                this.era_anchor = null;
            }

            get current_year() {
                const total_days = Math.floor(this._total_hours / this.HOURS_PER_DAY);
                let year = this.BASE_YEAR + Math.floor(total_days / this.DAYS_PER_YEAR);
                if (this.BASE_YEAR < 1 && year >= 0) {
                    year += 1; // 跳过公元0年
                }
                return year;
            }

            get current_day_in_year() {
                return Math.floor(this._total_hours / this.HOURS_PER_DAY) % this.DAYS_PER_YEAR + 1;
            }

            get current_month() {
                return Math.floor((this.current_day_in_year - 1) / 30) + 1;
            }

            get current_day_in_month() {
                return (this.current_day_in_year - 1) % 30 + 1;
            }

            get current_hour() {
                return this._total_hours % this.HOURS_PER_DAY;
            }

            advance_time(amount, unit) {
                let hours_to_add = 0;
                if (unit === 'day') hours_to_add = amount * this.HOURS_PER_DAY;
                else if (unit === 'hour') hours_to_add = amount;
                this._total_hours += hours_to_add;
            }

            reset() { this._total_hours = 0; }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const state = {
                timeManager: new TimeManager(window.gameConfig.EPOCH_START_YEAR),
                isRunning: false,
                speed: 100, // ms per tick, 10 ticks per second
                intervalId: null,
            };

            const dateDisplay = document.getElementById('date-display');
            const eraDisplay = document.getElementById('era-display');
            const startStopBtn = document.getElementById('start-stop-btn');
            const resetBtn = document.getElementById('reset-btn');

            function updateDisplay() {
                const tm = state.timeManager;
                const year = tm.current_year;
                const era = year < 0 ? '公元前' : '公元';
                const displayYear = Math.abs(year);

                dateDisplay.textContent = `${era} ${displayYear}年${tm.current_month}月${tm.current_day_in_month}日 ${tm.current_hour}点`;
                eraDisplay.textContent = "--"; // 简化，不显示年号
            }

            function tick() {
                state.timeManager.advance_time(1, 'day');
                updateDisplay();
            }

            function start() {
                if (state.isRunning) return;
                state.isRunning = true;
                startStopBtn.textContent = '停止';
                startStopBtn.classList.add('danger');
                state.intervalId = setInterval(tick, state.speed);
            }

            function stop() {
                if (!state.isRunning) return;
                state.isRunning = false;
                startStopBtn.textContent = '开始';
                startStopBtn.classList.remove('danger');
                clearInterval(state.intervalId);
            }

            function reset() {
                stop();
                state.timeManager.reset();
                updateDisplay();
            }

            window.quickAdvance = (amount, unit) => {
                if (state.isRunning) stop();
                state.timeManager.advance_time(amount, unit);
                updateDisplay();
            };

            startStopBtn.addEventListener('click', () => state.isRunning ? stop() : start());
            resetBtn.addEventListener('click', reset);

            // Initial display
            updateDisplay();
        });
    </script>
</body>
</html>